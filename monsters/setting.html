<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>ä»»å‹™è¨­å®šï½œå°æ€ªç¸æŒ‘æˆ°ç‹</title>
  <style>
    body {
      background: #FFFDF6;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    h1 {
      color: #C68A56;
      text-align: center;
      margin-bottom: 12px;
    }
    /* å°è¦½åˆ—æ¨£å¼ */
    .navbar {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .nav-btn {
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid #C68A56;
      background: #FFF4C8;
      font-size: 14px;
      text-decoration: none;
      color: #5A3B24;
    }
    .nav-btn.active {
      background: #C68A56;
      color: white;
      font-weight: bold;
    }

    .layout {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    @media (min-width: 900px) {
      .layout {
        flex-direction: row;
        align-items: flex-start;
      }
      .col {
        flex: 1;
      }
    }

    .panel {
      background: #FFFFFF;
      border-radius: 12px;
      border: 2px solid #C68A56;
      padding: 16px;
      margin-bottom: 12px;
    }
    .panel h2 {
      margin: 0 0 8px;
      font-size: 18px;
      color: #5A3B24;
    }
    .panel p {
      margin: 0 0 8px;
      font-size: 13px;
      color: #666;
    }

    .task-card {
      border: 1px solid #E0C7A0;
      border-radius: 10px;
      padding: 10px;
      margin-bottom: 8px;
      background: #FFFAED;
      font-size: 14px;
    }
    .task-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }
    .task-name {
      font-weight: bold;
    }
    .task-icon {
      font-size: 18px;
      margin-right: 4px;
    }
    .task-meta {
      font-size: 12px;
      color: #555;
    }
    .task-actions {
      margin-top: 4px;
      text-align: right;
      display: flex;
      gap: 6px;
      justify-content: flex-end;
    }
    button {
      padding: 6px 12px;
      background: #FFE680;
      border: none;
      border-radius: 8px;
      font-size: 13px;
      cursor: pointer;
    }
    button.danger {
      background: #F4B0A8;
    }
    button.small {
      font-size: 12px;
      padding: 4px 10px;
    }

    /* è¡¨å–®æ¨£å¼ */
    .form-row {
      margin-bottom: 10px;
    }
    label {
      display: block;
      font-size: 13px;
      margin-bottom: 3px;
      color: #5A3B24;
    }
    input[type="text"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      box-sizing: border-box;
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid #C68A56;
      font-size: 14px;
      background: #FFFCF4;
    }
    textarea {
      min-height: 60px;
      resize: vertical;
    }
    .hint {
      font-size: 12px;
      color: #888;
    }
    .json-box {
      width: 100%;
      box-sizing: border-box;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #C68A56;
      background: #FFFCF4;
      font-size: 11px;
      font-family: Consolas, monospace;
      white-space: pre-wrap;
    }
    .edit-indicator {
      font-size: 12px;
      color: #B35B3E;
      margin-bottom: 8px;
    }
  </style>
</head>
<body>

<h1>ä»»å‹™è¨­å®š</h1>

<!-- å°è¦½åˆ—ï¼šé€™ä¸€é æ˜¯ã€Œä»»å‹™è¨­å®šã€ -->
<div class="navbar">
  <a href="/dashboard.html" class="nav-btn">ä»Šæ—¥ä»»å‹™</a>
  <a href="/rewards.html" class="nav-btn">çå‹µå°å±‹</a>
  <a href="/settings.html" class="nav-btn active">ä»»å‹™è¨­å®š</a>
</div>

<div class="layout">
  <!-- å·¦é‚Šï¼šç›®å‰ä»»å‹™åˆ—è¡¨ -->
  <div class="col">
    <div class="panel">
      <h2>ç›®å‰ä»»å‹™åˆ—è¡¨</h2>
      <p>é€™è£¡æœƒé¡¯ç¤ºç¾åœ¨æ‰€æœ‰ä»»å‹™ã€‚ä¹‹å¾Œ dashboard å¯ä»¥æ”¹æˆè®€å–é€™ä»½è¨­å®šã€‚</p>
      <div id="task-list"></div>
    </div>

  <!-- å³é‚Šï¼šæ–°å¢ / ç·¨è¼¯ä»»å‹™è¡¨å–® -->
  <div class="col">
    <div class="panel">
      <h2>æ–°å¢ / ç·¨è¼¯ä»»å‹™</h2>
      <p>æ–°å¢ä»»å‹™å¾Œæœƒå„²å­˜åœ¨é€™å°è£ç½®çš„ç€è¦½å™¨ï¼ˆlocalStorageï¼‰ã€‚ä¹‹å¾Œå¯ä»¥å†ä¸²æ¥åˆ°å¾Œç«¯ã€‚</p>

      <div id="edit-indicator" class="edit-indicator" style="display:none;"></div>

      <div class="form-row">
        <label for="task-name">ä»»å‹™åç¨±ï¼ˆçµ¦çˆ¸åª½çœ‹ï¼‰</label>
        <input id="task-name" type="text" placeholder="ä¾‹å¦‚ï¼šæ•´ç†æ›¸åŒ…ã€æ”¶æ‹¾ç©å…·">
      </div>

      <div class="form-row">
        <label for="task-points">ä»»å‹™é»æ•¸</label>
        <input id="task-points" type="number" min="1" max="100" value="10">
      </div>

      <div class="form-row">
        <label for="task-schedule">ä»»å‹™é€±æœŸ</label>
        <select id="task-schedule">
          <option value="everyday">æ¯å¤©</option>
          <option value="weekdays">é€±ä¸€ï½é€±äº”</option>
          <option value="weekends">é€±å…­ã€é€±æ—¥</option>
          <option value="one-time">è‡¨æ™‚ä»»å‹™</option>
        </select>
        <div class="hint">å…ˆç”¨ç°¡å–®ç‰ˆæœ¬ï¼šæ¯å¤© / å¹³æ—¥ / é€±æœ«ã€‚ä¹‹å¾Œå¯ä»¥å†ç´°åˆ†åˆ°æ¯å¤©ã€‚</div>
      </div>

      <div class="form-row">
        <label for="task-icon">åœ–æ¡ˆï¼ˆemojiï¼Œå¯é¸ï¼‰</label>
        <input id="task-icon" type="text" placeholder="ä¾‹å¦‚ï¼šğŸ§¸ / ğŸ“š / â­ ï¼›å¦‚æœç•™ç™½æœƒç”¨é è¨­åœ–æ¡ˆ">
        <div class="hint">ä¸å¡«çš„è©±ï¼Œæœƒè‡ªå‹•ä½¿ç”¨é è¨­ emojiï¼ˆâ­ï¼‰ã€‚</div>
      </div>

      <div class="form-row">
        <label for="task-tts">èªéŸ³æœ—è®€å…§å®¹ï¼ˆå¯é¸ï¼Œçµ¦å°å­©è½ï¼‰</label>
        <textarea id="task-tts" placeholder="ä¾‹å¦‚ï¼šæ•´ç†æ›¸åŒ…ï¼Œæ˜å¤©ä¸Šå­¸æ‰ä¸æœƒå¿˜è¨˜æ±è¥¿ã€‚"></textarea>
        <div class="hint">ä¸å¡«çš„è©±ï¼Œæœƒç”¨ä»»å‹™åç¨±ç›´æ¥å”¸ã€‚</div>
      </div>

      <div class="form-row" style="display:flex; gap:8px;">
        <button id="add-task-btn">ï¼‹ æ–°å¢ä»»å‹™</button>
        <button id="cancel-edit-btn" type="button" class="small" style="display:none;">
          å–æ¶ˆç·¨è¼¯
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  // å„²å­˜åœ¨ localStorage çš„ key
  const STORAGE_KEY = "monsters_tasks_config_v1";
  const DEFAULT_ICON = "â­";

  // é è¨­ä»»å‹™ï¼ˆç¬¬ä¸€æ¬¡æ²’æœ‰è³‡æ–™æ™‚ä½¿ç”¨ï¼‰
  const defaultTasks = [
    {
      id: 1,
      name: "èµ·åºŠä¸è³´åºŠ",
      points: 10,
      schedule: "everyday",
      icon: "â°",
      ttsText: "èµ·åºŠä¸è³´åºŠï¼Œå°å‹‡å£«å‡ºç™¼å›‰ï¼"
    },
    {
      id: 2,
      name: "è‡ªå·±åˆ·ç‰™",
      points: 10,
      schedule: "everyday",
      icon: "ğŸª¥",
      ttsText: "è‡ªå·±åˆ·ç‰™ï¼Œç‰™é½’äº®æ™¶æ™¶ã€‚"
    },
    {
      id: 3,
      name: "å®Œæˆå­¸æ ¡ä½œæ¥­",
      points: 20,
      schedule: "weekdays",
      icon: "ğŸ“š",
      ttsText: "å…ˆå®Œæˆå­¸æ ¡ä½œæ¥­ï¼Œå†é–‹å¿ƒç©è€ã€‚"
    },
    {
      id: 4,
      name: "æ•´ç†æ›¸åŒ…",
      points: 10,
      schedule: "weekdays",
      icon: "ğŸ’",
      ttsText: "æ•´ç†æ›¸åŒ…ï¼Œæ˜å¤©æ‰ä¸æœƒå¿˜æ±è¥¿ã€‚"
    },
    {
      id: 5,
      name: "æ”¶æ‹¾ç©å…·",
      points: 10,
      schedule: "everyday",
      icon: "ğŸ§¸",
      ttsText: "ç©å®Œç©å…·ï¼Œä¸€èµ·æŠŠå°å¤¥ä¼´å€‘é€å›å®¶ã€‚"
    }
  ];

  let tasks = [];
  let editingTaskId = null; // null ä»£è¡¨ã€Œæ–°å¢æ¨¡å¼ã€

  function loadTasks() {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
      try {
        tasks = JSON.parse(saved);
      } catch (e) {
        console.error("è§£æä»»å‹™è¨­å®šå¤±æ•—ï¼Œæ”¹ç”¨é è¨­ä»»å‹™", e);
        tasks = defaultTasks.slice();
      }
    } else {
      tasks = defaultTasks.slice();
    }
  }

  function saveTasks() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
    renderTaskList();
    renderJsonView();
  }

  function renderTaskList() {
    const container = document.getElementById("task-list");
    container.innerHTML = "";

    if (tasks.length === 0) {
      container.innerHTML = '<p class="hint">ç›®å‰æ²’æœ‰ä»»å‹™ï¼Œè«‹å¾å³é‚Šæ–°å¢ã€‚</p>';
      return;
    }

    tasks.forEach(task => {
      const scheduleText =
        task.schedule === "everyday"
          ? "æ¯å¤©"
          : task.schedule === "weekdays"
          ? "é€±ä¸€ï½é€±äº”"
          : task.schedule === "weekends"
          ? "é€±å…­ã€é€±æ—¥"
          : task.schedule || "æœªè¨­å®š";

      const iconToShow = task.icon || DEFAULT_ICON;

      const div = document.createElement("div");
      div.className = "task-card";
      div.innerHTML = `
        <div class="task-header">
          <div>
            <span class="task-icon">${iconToShow}</span>
            <span class="task-name">${task.name}</span>
          </div>
          <div>${task.points} åˆ†</div>
        </div>
        <div class="task-meta">
          é€±æœŸï¼š${scheduleText}
        </div>
        <div class="task-meta">
          èªéŸ³å…§å®¹ï¼š${task.ttsText ? task.ttsText : "ï¼ˆæœªè¨­å®šï¼Œæœƒå”¸ä»»å‹™åç¨±ï¼‰"}
        </div>
        <div class="task-actions">
          <button class="small" onclick="startEditTask(${task.id})">ç·¨è¼¯</button>
          <button class="danger small" onclick="deleteTask(${task.id})">åˆªé™¤</button>
        </div>
      `;
      container.appendChild(div);
    });
  }

  function renderJsonView() {
    const jsonBox = document.getElementById("json-view");
    jsonBox.value = JSON.stringify(tasks, null, 2);
  }

  function resetFormToCreateMode() {
    editingTaskId = null;
    document.getElementById("task-name").value = "";
    document.getElementById("task-points").value = "10";
    document.getElementById("task-schedule").value = "everyday";
    document.getElementById("task-icon").value = "";
    document.getElementById("task-tts").value = "";

    document.getElementById("add-task-btn").textContent = "ï¼‹ æ–°å¢ä»»å‹™";
    document.getElementById("edit-indicator").style.display = "none";
    document.getElementById("cancel-edit-btn").style.display = "none";
  }

  function startEditTask(id) {
    const t = tasks.find(task => task.id === id);
    if (!t) return;

    editingTaskId = id;

    // æŠŠä»»å‹™å…§å®¹å¸¶å…¥è¡¨å–®
    document.getElementById("task-name").value = t.name;
    document.getElementById("task-points").value = t.points;
    document.getElementById("task-schedule").value = t.schedule || "everyday";
    document.getElementById("task-icon").value = t.icon || "";
    document.getElementById("task-tts").value = t.ttsText || "";

    // æ›´æ–° UI æç¤º
    const indicator = document.getElementById("edit-indicator");
    indicator.textContent = `ç›®å‰æ­£åœ¨ç·¨è¼¯ï¼š${t.name}`;
    indicator.style.display = "block";

    const addBtn = document.getElementById("add-task-btn");
    addBtn.textContent = "å„²å­˜ä¿®æ”¹";

    const cancelBtn = document.getElementById("cancel-edit-btn");
    cancelBtn.style.display = "inline-block";
  }

  function handleFormSubmit() {
    const nameInput = document.getElementById("task-name");
    const pointsInput = document.getElementById("task-points");
    const scheduleSelect = document.getElementById("task-schedule");
    const iconInput = document.getElementById("task-icon");
    const ttsInput = document.getElementById("task-tts");

    const name = nameInput.value.trim();
    const points = parseInt(pointsInput.value, 10);
    const schedule = scheduleSelect.value;
    const icon = iconInput.value.trim();
    const ttsText = ttsInput.value.trim();

    if (!name) {
      alert("è«‹è¼¸å…¥ä»»å‹™åç¨±");
      return;
    }
    if (isNaN(points) || points <= 0) {
      alert("è«‹è¼¸å…¥å¤§æ–¼ 0 çš„é»æ•¸");
      return;
    }

    if (editingTaskId === null) {
      // ğŸ‘‰ æ–°å¢æ¨¡å¼
      const newId =
        tasks.length > 0 ? Math.max(...tasks.map(t => t.id)) + 1 : 1;

      const newTask = {
        id: newId,
        name,
        points,
        schedule,
        icon: icon || undefined,
        ttsText: ttsText || undefined
      };

      tasks.push(newTask);
      saveTasks();
      resetFormToCreateMode();
      alert("å·²æ–°å¢ä»»å‹™ï¼šã€Œ" + name + "ã€");
    } else {
      // ğŸ‘‰ ç·¨è¼¯æ¨¡å¼
      const t = tasks.find(task => task.id === editingTaskId);
      if (!t) {
        alert("æ‰¾ä¸åˆ°é€™å€‹ä»»å‹™ï¼Œè«‹é‡æ–°æ•´ç†é é¢");
        return;
      }

      t.name = name;
      t.points = points;
      t.schedule = schedule;
      t.icon = icon || undefined;
      t.ttsText = ttsText || undefined;

      saveTasks();
      resetFormToCreateMode();
      alert("å·²æ›´æ–°ä»»å‹™ï¼šã€Œ" + name + "ã€");
    }
  }

  function deleteTask(id) {
    const target = tasks.find(t => t.id === id);
    if (!target) return;
    const ok = confirm(`ç¢ºå®šè¦åˆªé™¤ä»»å‹™ã€Œ${target.name}ã€å—ï¼Ÿ`);
    if (!ok) return;

    tasks = tasks.filter(t => t.id !== id);
    saveTasks();

    // å¦‚æœæ­£åœ¨ç·¨è¼¯é€™ä¸€ç­†ï¼Œé †ä¾¿é€€å‡ºç·¨è¼¯æ¨¡å¼
    if (editingTaskId === id) {
      resetFormToCreateMode();
    }
  }

  // ç¶å®šæŒ‰éˆ•äº‹ä»¶
  document.addEventListener("DOMContentLoaded", () => {
    loadTasks();
    renderTaskList();
    renderJsonView();

    document
      .getElementById("add-task-btn")
      .addEventListener("click", handleFormSubmit);

    document
      .getElementById("cancel-edit-btn")
      .addEventListener("click", resetFormToCreateMode);
  });
</script>

</body>
</html>
